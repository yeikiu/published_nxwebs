import{b4 as Fe}from"./lucide-BZTUuGOE.js";import{$ as Se,C as be,z as Ee,D as Be}from"./index-DlYYUIAG.js";function Ne(e){return!e||typeof e!="string"?"":e.replace(/\s*\([^)]*\)\s*/g,"").trim()}function ot(e){if(!e||typeof e!="string")return null;const t=e.match(/\(([^)]+)\)/);return t?t[1]:null}function j(e){return!e||typeof e!="string"?"":e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().replace(/[^a-z0-9]/g,"").trim()}const E={AT:"ðŸ”´",ANT:"ðŸŸ¡",PT:"ðŸ”µ",PNT:"ðŸŸ¢"};function rt(e){if(!e)return{type:"loading",label:"â­•",name:"Analizando...",tooltip:"Calculando arquetipo..."};const t=e.combinedRole.split("+"),[s,i,n]=t,o=[];[s,i,n].filter(c=>!!c).forEach(c=>{const a=E[c];o.push(`${a} ${c}`)}),e.inTransition&&o.push("En transiciÃ³n");const r=o.join(`
`);return{type:e.isTriple?"triple":e.isDual?"dual":"single",label:`${E[s]}${i?E[i]:""}${n?E[n]:""}`,name:e.combinedRole,tooltip:r}}function ct(e,t){if(t.length===0)throw new Error(`No fighters data provided for division: ${e}`);const s=t.length,i=t.reduce((n,o)=>(n.Sig_Strikes_Thrown+=o.Sig_Strikes_Thrown,n.Sig_Strikes_Landed+=o.Sig_Strikes_Landed,n.Sig_Strikes_Absorbed+=o.Sig_Strikes_Absorbed,n.Takedowns_Attempted+=o.Takedowns_Attempted,n.Takedowns_Successful+=o.Takedowns_Successful,n.Takedowns_Defended+=o.Takedowns_Defended,n.Sub_Attempts+=o.Sub_Attempts,n.Sub_Attempts_Defended+=o.Sub_Attempts_Defended,n.Knockdowns+=o.Knockdowns,n.Knockdowns_Received+=o.Knockdowns_Received,n.Control_Time_Seconds+=o.Control_Time_Seconds,n.Time_Controlled_Seconds+=o.Time_Controlled_Seconds,n.height_inches+=o.height_inches,n.reach_inches+=o.reach_inches,n.win+=o.win,n.loss+=o.loss,n.draws+=o.draws,n.win_kotko+=o.win_kotko,n.win_sub+=o.win_sub,n.win_decision+=o.win_decision,n.loss_kotko+=o.loss_kotko,n.loss_sub+=o.loss_sub,n.loss_decision+=o.loss_decision,n.Fight_Duration_Seconds+=o.Fight_Duration_Seconds,n.significant_strikes_attempted_against+=o.significant_strikes_attempted_against,n.takedowns_attempted_against+=o.takedowns_attempted_against,n.takedowns_allowed+=o.takedowns_allowed,n.submission_attempts_against+=o.submission_attempts_against,n.Number_of_Fights_36m+=o.Number_of_Fights_36m,n),{Sig_Strikes_Thrown:0,Sig_Strikes_Landed:0,Sig_Strikes_Absorbed:0,Takedowns_Attempted:0,Takedowns_Successful:0,Takedowns_Defended:0,Sub_Attempts:0,Sub_Attempts_Defended:0,Knockdowns:0,Knockdowns_Received:0,Control_Time_Seconds:0,Time_Controlled_Seconds:0,height_inches:0,reach_inches:0,win:0,loss:0,draws:0,win_kotko:0,win_sub:0,win_decision:0,loss_kotko:0,loss_sub:0,loss_decision:0,Fight_Duration_Seconds:0,significant_strikes_attempted_against:0,takedowns_attempted_against:0,takedowns_allowed:0,submission_attempts_against:0,Number_of_Fights_36m:0});return{id:"",Fighter:`${e} Average`,cleanName:`${e} Average`,Division:e,Birth_Date:"",Career_Record:"",Sig_Strikes_Thrown:i.Sig_Strikes_Thrown/s,Sig_Strikes_Landed:i.Sig_Strikes_Landed/s,Sig_Strikes_Absorbed:i.Sig_Strikes_Absorbed/s,Takedowns_Attempted:i.Takedowns_Attempted/s,Takedowns_Successful:i.Takedowns_Successful/s,Takedowns_Defended:i.Takedowns_Defended/s,Sub_Attempts:i.Sub_Attempts/s,Sub_Attempts_Defended:i.Sub_Attempts_Defended/s,Knockdowns:i.Knockdowns/s,Knockdowns_Received:i.Knockdowns_Received/s,Control_Time_Seconds:i.Control_Time_Seconds/s,Time_Controlled_Seconds:i.Time_Controlled_Seconds/s,height_inches:i.height_inches/s,reach_inches:i.reach_inches/s,win:i.win/s,loss:i.loss/s,draws:i.draws/s,win_kotko:i.win_kotko/s,win_sub:i.win_sub/s,win_decision:i.win_decision/s,loss_kotko:i.loss_kotko/s,loss_sub:i.loss_sub/s,loss_decision:i.loss_decision/s,Fight_Duration_Seconds:i.Fight_Duration_Seconds/s,significant_strikes_attempted_against:i.significant_strikes_attempted_against/s,takedowns_attempted_against:i.takedowns_attempted_against/s,takedowns_allowed:i.takedowns_allowed/s,submission_attempts_against:i.submission_attempts_against/s,Number_of_Fights_36m:i.Number_of_Fights_36m/s,Dates_36m:"",picture_url:"",ufcstats_url:""}}function at(e){return!e||typeof e!="string"?"":e.replace(/W_/g,"Women's ").replace(/_/g," ")}function lt(e,t){if(!e||e==="N/A")return[];const s=e.split(",").map(n=>n.trim()).filter(n=>n),i=new Date;return s.map(n=>{let o,r,c,a="";if(n.includes(":")){const l=n.split(":"),f=l[0];a=l[1]||"";let p="";if(l.length>=3&&(p=l[2]),f.includes("-")){const[S,F,k]=f.split("-");o=F,r=k,c=new Date(parseInt(k),parseInt(F)-1,parseInt(S))}else[o,r]=f.split("/"),c=new Date(2e3+parseInt(r),parseInt(o)-1);p&&(a+=`|${p}`)}else[o,r]=n.split("/"),c=new Date(2e3+parseInt(r),parseInt(o)-1);let d="",h=a;if(a.includes("|")){const l=a.split("|");h=l[0],d=l[1]}if(!o||!r)return{original:n,monthsAgo:0,fighterId:h,fighter:t.find(l=>l.ufcstats_url.endsWith(h))??null,dateString:n,result:d||void 0};const g=i.getTime()-c.getTime(),u=Math.floor(g/(1e3*60*60*24*30.44)),_=String(o).padStart(2,"0"),m=r.length===4?r.slice(2):r;return{original:`${_}/${m}`,monthsAgo:Math.max(0,u),fighterId:h,fighter:t.find(l=>l.ufcstats_url.endsWith(h))??null,dateString:`${_}/${m}`,result:d||void 0}}).sort((n,o)=>n.monthsAgo-o.monthsAgo)}function Ce(e){if(!e)return 0;const t=e.split(",").map(o=>{const r=o.trim().split(":");if(r.length<3)return null;const[c,,a]=r,[d,h,g]=c.split("-").map(Number);return{date:new Date(g,h-1,d),result:a.trim()}}).filter(o=>o!==null);if(t.sort((o,r)=>r.date.getTime()-o.date.getTime()),t.length===0)return 0;const s=t[0].result;if(s==="D"||s==="NC")return 0;let i=0;const n=s;for(const o of t)if(!(o.result==="NC"||o.result==="D"))if(o.result===n)i++;else break;return n==="W"?i:-i}function Ie(e){if(!e||e.trim()==="")return null;const t=/^(\d{1,2})-(\d{1,2})-(\d{4})$/,s=e.match(t);if(s){const[,i,n,o]=s,r=new Date(parseInt(o),parseInt(n)-1,parseInt(i));if(r.getDate()===parseInt(i)&&r.getMonth()===parseInt(n)-1&&r.getFullYear()===parseInt(o))return r}return null}function Le(e){if(!e||e.trim()==="")return 0;const t=Ie(e);if(!t)return 0;const s=new Date;let i=s.getFullYear()-t.getFullYear();const n=s.getMonth()-t.getMonth();return(n<0||n===0&&s.getDate()<t.getDate())&&i--,Math.max(0,i)}function dt(e){if(!e)return 0;const t=e.match(/\((\d+)\s*NC\)/i);return t?parseInt(t[1]):0}function Oe(e){const t=e.trim().split(`
`),s=t[0].split(",").map(n=>n.replace(/"/g,"").trim()),i=[];for(let n=1;n<t.length;n++){const o=Ke(t[n]);if(o.length!==s.length){console.warn(`LÃ­nea ${n+1} tiene ${o.length} campos, esperados ${s.length}`);continue}const r={};s.forEach((a,d)=>{r[a]=o[d]});const c=De(r);c&&i.push(c)}return i}function Ke(e){const t=[];let s="",i=!1;for(let n=0;n<e.length;n++){const o=e[n];o==='"'?i=!i:o===","&&!i?(t.push(s.trim()),s=""):s+=o}return t.push(s.trim()),t}function De(e){try{const t=e.Division,s=e.Fighter;if(!t||!s)return null;const i=s.replace(/"/g,"");return{id:e.ufcstats_url&&e.ufcstats_url.split("/").pop()||"",Fighter:i,cleanName:Ne(i),Division:t,division_ranking:e.division_ranking||"",Birth_Date:e.Birth_Date||"",Career_Record:e.Career_Record||"",Sig_Strikes_Thrown:parseFloat(e.Sig_Strikes_Thrown)||0,Sig_Strikes_Landed:parseFloat(e.Sig_Strikes_Landed)||0,Sig_Strikes_Absorbed:parseFloat(e.Sig_Strikes_Absorbed)||0,Takedowns_Attempted:parseFloat(e.Takedowns_Attempted)||0,Takedowns_Successful:parseFloat(e.Takedowns_Successful)||0,Takedowns_Defended:parseFloat(e.Takedowns_Defended)||0,Sub_Attempts:parseFloat(e.Sub_Attempts)||0,Sub_Attempts_Defended:parseFloat(e.Sub_Attempts_Defended)||0,Knockdowns:parseFloat(e.Knockdowns)||0,Knockdowns_Received:parseFloat(e.Knockdowns_Received)||0,Control_Time_Seconds:parseFloat(e.Control_Time_Seconds)||0,Time_Controlled_Seconds:parseFloat(e.Time_Controlled_Seconds)||0,height_inches:parseFloat(e.height_inches)||0,reach_inches:parseFloat(e.reach_inches)||0,win:parseFloat(e.win)||0,loss:parseFloat(e.loss)||0,draws:parseFloat(e.draws)||0,win_kotko:parseFloat(e.win_kotko)||0,win_sub:parseFloat(e.win_sub)||0,win_decision:parseFloat(e.win_decision)||0,loss_kotko:parseFloat(e.loss_kotko)||0,loss_sub:parseFloat(e.loss_sub)||0,loss_decision:parseFloat(e.loss_decision)||0,Fight_Duration_Seconds:parseFloat(e.Fight_Duration_Seconds)||1,significant_strikes_attempted_against:parseFloat(e.significant_strikes_attempted_against)||0,takedowns_attempted_against:parseFloat(e.takedowns_attempted_against)||0,takedowns_allowed:parseFloat(e.takedowns_allowed)||0,submission_attempts_against:parseFloat(e.submission_attempts_against)||0,Number_of_Fights_36m:parseFloat(e.Number_of_Fights_36m)||0,Dates_36m:e.Dates_36m||"",picture_url:e.picture_url||"",ufcstats_url:e.ufcstats_url||""}}catch(t){return console.error("Error procesando luchador:",e.Fighter||e.Name,t),null}}async function $e(e){const t=await fetch(e);if(!t.ok)throw new Error(`No se pudo cargar ${e}: ${t.status}`);return await t.text()}async function ht(e){try{const t=await fetch(e,{method:"HEAD"});if(!t.ok)throw new Error(`No se pudo obtener informaciÃ³n del archivo ${e}: ${t.status}`);const s=t.headers.get("last-modified"),i=t.headers.get("content-length"),n=t.headers.get("etag");return{lastModified:s?new Date(s):null,size:i?parseInt(i,10):null,etag:n||null}}catch(t){return console.warn(`Error getting file stats for ${e}:`,t),{lastModified:null,size:null,etag:null}}}function ut(){const t=Fe(Se)("charts.fight_radar_categories");return Array.isArray(t)?t:["Striking Offense","Striking Defense","Takedown Offense","Takedown Defense","Control","Finish Threat"]}function gt(){const t=Fe(Se)("charts.iq_radar_categories");return Array.isArray(t)?t:["Distance","Adaptability","Composure","Decisions","Rhythm","Feints"]}function Me(e){const t=Number(e.Sig_Strikes_Landed)||0,s=Number(e.Sig_Strikes_Thrown)||0,i=Number(e.Sig_Strikes_Absorbed)||0,n=Number(e.significant_strikes_attempted_against)||0,o=Number(e.Takedowns_Successful)||0,r=Number(e.Takedowns_Attempted)||0,c=Number(e.Takedowns_Defended)||0,a=Number(e.takedowns_attempted_against)||0,d=Number(e.Control_Time_Seconds)||0,h=Number(e.Time_Controlled_Seconds)||0,g=Number(e.win)||0,u=Number(e.win_kotko)||0,_=Number(e.win_sub)||0;let m=s>0?t/s*100:0,l=n>0?(n-i)/n*100:85,f=r>0?o/r*100:45,p=a>0?c/a*100:85,S=d+h>0?d/(d+h)*100:50,F=g>0?(u+_)/g*100:0;const k={STR_OFF:m,STR_DEF:l,TD_OFF:f,TD_DEF:p,CTRL:S,FIN_THREAT:F};return{STR_OFF:k.STR_OFF>100?100:Math.round(k.STR_OFF),STR_DEF:k.STR_DEF>100?100:Math.round(k.STR_DEF),TD_OFF:k.TD_OFF>100?100:Math.round(k.TD_OFF),TD_DEF:k.TD_DEF>100?100:Math.round(k.TD_DEF),CTRL:k.CTRL>100?100:Math.round(k.CTRL),FIN_THREAT:k.FIN_THREAT>100?100:Math.round(k.FIN_THREAT)}}function Pe(e,t){const s=e.Sig_Strikes_Landed||0,i=e.Sig_Strikes_Thrown||0,n=e.Sig_Strikes_Absorbed||0,o=e.significant_strikes_attempted_against||0,r=e.Takedowns_Defended||0,c=e.takedowns_attempted_against||0,a=e.Fight_Duration_Seconds||1,d=e.win||0,h=e.loss||0,g=e.draws||0,u=e.win_kotko||0,_=e.win_sub||0,m=e.Knockdowns||0,l=e.Knockdowns_Received||0,f=a/60,p=d+h+g||1,S=f>0?s/(f*p):0,F=i>0?s/i*100:0,k=o>0?n/o*100:0,M=c>0?r/c*100:0,T=d/p,v=(u+_)/p*100,P=e.reach_inches||70,N=e.height_inches||70,R=P-N,C=Math.min(Math.max(R-2,0),10)*4,x=s-n,Y=x>0?Math.min(x*.3,40):Math.max(x*.2,-20),z=40+C+Y,I=Math.round(Math.min(Math.max(z,15),85)),q=(k+M)/2-n/Math.max(p,1),A=Math.max(q*.8,0),L=f*p,O=L>10?Math.min((L-10)*2,25):0,J=p-l,Z=Math.min(J*3,20),X=40+A+O+Z,V=Math.round(Math.min(Math.max(X,20),85)),K=Math.min(T*.4,.4),w=((u>0?1:0)+(_>0?1:0))/3*.15;let y=0;t.isTriple?y=.25:t.isDual?y=.15:y=-.1;const W=K+w+y,ee=Math.round(Math.min(Math.max(W*100,5),95)),te=T>v/100?Math.min((T-v/100)*50,25):0,b=e.Takedowns_Attempted>0?e.Takedowns_Successful/e.Takedowns_Attempted*30:15,se=e.Control_Time_Seconds||0,ie=e.Time_Controlled_Seconds||0,B=se-ie,ne=B>0?Math.min(B*.15,20):Math.max(B*.1,-15),G=35+te+b+ne,oe=Math.round(Math.min(Math.max(G,15),85)),H=i-n,ue=H>0?Math.min(H*.25,30):0,D=f*p,re=D<8?Math.min((8-D)*5,25):D>12?Math.max((12-D)*2,-15):10,ce=S>3?Math.min((S-3)*8,20):S*6,ge=35+ue+re+ce,ae=Math.round(Math.min(Math.max(ge,15),85)),Q=i>0?F/100:0,ve=Q>.5?Math.min((Q-.5)*80,30):0,le=m-l,Re=le>0?Math.min(le*15,25):Math.max(le*5,-15),Ae=B>60?Math.min((B-60)*.1,15):0,we=35+ve+Re+Ae,ye=Math.round(Math.min(Math.max(we,15),85));return{distance:I,adaptability:ee,composure:V,decisions:oe,rhythm:ae,feints:ye}}class Te{constructor(t){this.metrics=this.calculateMetrics(t)}calculateMetrics(t){const s=t.win||0,i=t.loss||0,n=t.draws||0,o=s+i+n,r=t.win_kotko||0,c=t.win_sub||0,a=t.Knockdowns||0,d=t.Knockdowns_Received||0,h=i===0&&s>0,g=o>0?s/o:0,u=r+c,_=o>0?u/o*100:0,m=d>0?a/d:a+1,l=t.Fight_Duration_Seconds>0?t.Fight_Duration_Seconds/60:15;return{isUndefeated:h,wins:s,losses:i,winRate:g,finishRate:_,totalFights:t.Number_of_Fights_36m||o,knockdowns:a,knockdownsReceived:d,knockdownRatio:m,subWins:c,koTkoWins:r,avgFightTime:l,isEliteFinisher:_>70&&o>=4,isSubmissionSpecialist:c>=3&&h,isKnockoutArtist:r>=3&&a>d+2}}getStrikingOffenseBonuses(){const t=this.metrics;return t.isUndefeated&&t.isEliteFinisher?{primary:t.isKnockoutArtist?1.44:1.25,secondary:1.15,additive:8}:t.isUndefeated&&t.finishRate>50?{primary:1.18,secondary:1.1,additive:5}:t.isUndefeated&&t.totalFights>=3?{primary:1.12,secondary:1.05,additive:3}:t.winRate>.85&&t.totalFights>=5?{primary:1.08,secondary:1.03,additive:2}:{primary:1,secondary:1,additive:0}}getDefensiveBonuses(){const t=this.metrics;return t.winRate===1&&t.totalFights>=4?{primary:1.15,secondary:1.1,additive:4}:t.winRate>.9&&t.totalFights>=4?{primary:1.08,secondary:1.05,additive:2}:{primary:1,secondary:1,additive:0}}getFinishingBonuses(){const t=this.metrics;return t.isUndefeated&&t.isEliteFinisher?{primary:t.isSubmissionSpecialist?1.68:1.4,secondary:1.2,additive:15}:t.isUndefeated&&t.finishRate>50?{primary:1.3,secondary:1.15,additive:10}:t.isUndefeated&&t.totalFights>=3?{primary:1.2,secondary:1.1,additive:6}:{primary:1,secondary:1,additive:0}}getControlBonuses(){const t=this.metrics;return t.isSubmissionSpecialist?{primary:1.25,secondary:1.15,additive:8}:t.isUndefeated&&t.totalFights>=4?{primary:1.1,secondary:1.05,additive:3}:{primary:1,secondary:1,additive:0}}getVolumeBonuses(){const t=this.metrics;if(t.isUndefeated&&t.isEliteFinisher){let s=1.4,i=30;return t.isKnockoutArtist&&(s*=1.15,i+=12),t.isSubmissionSpecialist&&(s*=1.18,i+=15),{primary:Math.min(s,1.8),secondary:1.18,additive:Math.min(i,50)}}else{if(t.isUndefeated&&t.finishRate>50)return{primary:1.25,secondary:1.12,additive:20};if(t.isUndefeated&&t.totalFights>=3)return{primary:1.15,secondary:1.08,additive:15}}return{primary:1,secondary:1,additive:0}}getEliteClassification(){const t=this.metrics;return t.isUndefeated&&t.isEliteFinisher?t.isKnockoutArtist&&t.isSubmissionSpecialist?"Complete Dominator":t.isKnockoutArtist?"Knockout Artist":t.isSubmissionSpecialist?"Submission Specialist":"Elite Finisher":t.isUndefeated&&t.finishRate>50?"Undefeated Finisher":t.isUndefeated?"Undefeated Prospect":t.winRate>.85&&t.totalFights>=6?"Elite Veteran":"Standard Fighter"}getMetrics(){return{...this.metrics}}}function xe(e,t){let s=null,i=null;if(We(e))s="AT",i=E[s];else{const oe=t.map(Q=>_e(Q)),H=Math.round($(oe)),D=_e(e)>=H?"A":"P",re=t.map(de),ce=Math.round($(re)),ae=de(e)>=ce?"T":"NT";s=`${D}${ae}`,i=E[s]}const n=t.map(me),o=Math.round($(n)),r=Math.min(...n),c=Math.max(...n),a=(r+o)/2,d=(o+c)/2,h=me(e),g=h>=o?"A":"P";let u="Muy Bajo";h>=d?u="Muy Alto":h>=o?u="Medio-Alto":h>=a&&(u="Medio-Bajo");const _=t.map(U),m=Math.round($(_)),l=Math.min(..._),f=Math.max(..._),p=(l+m)/2,S=(m+f)/2,F=U(e),k=F>=m?"T":"NT";let M="Muy Bajo";F>=S?M="Muy Alto":F>=m?M="Medio-Alto":F>=p&&(M="Muy Bajo");let T=u==="Muy Alto"&&M==="Medio-Bajo"||u==="Medio-Alto"&&M==="Muy Alto"||u==="Medio-Bajo"&&M==="Medio-Alto"||u==="Muy Bajo"&&M==="Muy Bajo";const v=`${g}${k}`,P=E[v];T=T&&s!==v;const N=t.map(fe),R=Math.round($(N)),C=Math.min(...N),x=Math.max(...N),Y=(C+R)/2,z=(R+x)/2,I=fe(e),q=I>=R?"A":"P";let A="Muy Bajo";I>=z?A="Muy Alto":I>=R?A="Medio-Alto":I>=Y&&(A="Medio-Bajo");const L=t.map(pe),O=Math.round($(L)),J=Math.min(...L),Z=Math.max(...L),X=(J+O)/2,V=(O+Z)/2,K=pe(e),he=K>=O?"T":"NT";let w="Muy Bajo";K>=V?w="Muy Alto":K>=O?w="Medio-Alto":K>=X&&(w="Muy Bajo");let y=A==="Muy Bajo"&&w==="Medio-Bajo"||A==="Medio-Bajo"&&w==="Muy Alto"||A==="Medio-Alto"&&w==="Medio-Alto"||A==="Muy Alto"&&w==="Muy Bajo";const W=`${q}${he}`,ee=E[W];y=y&&![s,v].includes(W);const te=`${i}${T?P:""}${y?ee:""}`,b=`${s}${T?`+${v}`:""}${y?`+${W}`:""}`,se=`@ARCHETYPE_${b}_DESCRIPTION`,ie=`@ARCHETYPE_${b}_FAVORITE_ZONE`,B=`@ARCHETYPE_${b}_STRENGTHS`,ne=`@ARCHETYPE_${b}_WEAKNESSES`,G=b.split("+").length;return{combinedRole:b,inTransition:G>1,isDual:G===2,isTriple:G===3,archetypeEmojis:te,description:se,favoriteZone:ie,strengths:B,weaknesses:ne}}function _e(e){const t=e.Sig_Strikes_Thrown||0,s=e.Takedowns_Attempted||0,i=e.Sub_Attempts||0,n=e.Control_Time_Seconds||0,r=(e.Fight_Duration_Seconds||1)/60,c=r>0?n/r:0,a=30,d=.25,h=c>a?6:7,g=c/h,u=t+s+i+g,_=r>0?u/r:0,m=de(e),l=U(e);let f=_*.35+m*.35+l*.3;const p=n/(t+n+1);if(p>d*1.5&&c>a*1.2){const k=Math.max(0,c/a-1),M=Math.max(0,p/d-1),T=(k+M)*2.5;f+=T}if(m>60){const k=1+(m-60)/200;f*=k}if(r<6&&l>60){const k=(6-r)/6*(l/100)*10;f+=k}const F=new Te(e).getVolumeBonuses();return f=(f+F.additive)*F.primary,Math.round(f*100)/100}function de(e){const t=e.Sig_Strikes_Landed||0,s=e.Sig_Strikes_Thrown||0,i=e.Takedowns_Successful||0,n=e.Takedowns_Attempted||0,r=U(e)>50,c=r?.9:.85,a=r?.1:.15,d=s>0?t/s*100:0,h=n>0?i/n*100:0;let g=0;if(s>0&&n>0)g=d*c+h*a;else if(s>0)g=d;else if(n>0)g=h;else return 50;const u=e.loss_kotko||0,_=e.loss_sub||0,m=e.Knockdowns_Received||0,l=e.Number_of_Fights_36m,f=l>0?(u+_)/l:0,p=l>0?m/l:0,S=(e.Fight_Duration_Seconds||300)/60,F=e.significant_strikes_attempted_against>0?(e.significant_strikes_attempted_against-e.Sig_Strikes_Absorbed)/e.significant_strikes_attempted_against:.6,M=S>8&&F>.6?.6:1,T=Math.min(f*1*M,.45),v=Math.min(p*.4*M,.15),P=Math.min(T+v,.55),R=new Te(e).getStrikingOffenseBonuses();if(g=(g+R.additive)*R.primary,g=g*(1-P),g>55){const C=(g-55)/45*10;g+=C}return Math.min(Math.round(g),100)}function U(e){const t=e.win||0,s=e.loss||0,i=e.draws||0,n=e.win_kotko||0,o=e.win_sub||0,r=t+s+i;if(r===0)return 0;let c=(n+o)/r*100;const a=n+o,d=r>0?t/r:0,h=e.Fight_Duration_Seconds>0?e.Fight_Duration_Seconds/60:15;if(h<8&&c>30){const l=Math.min((8-h)*2,8);c+=l}const g=(n>0?1:0)+(o>0?1:0);if(g>=2&&a>=3){const l=g*2;c+=l}const u=r>0?n/r*100:0;if(u>40){const l=Math.min((u-40)*.15,6);c+=l}const _=r>0?o/r*100:0,m=r>0?e.Sub_Attempts/r:0;if(_>20||m>1.5){const l=Math.min(_*.1+m,4);c+=l}if(d>.85&&r>=5){const l=Math.min((d-.85)*20,3);c+=l}if(e.reach_inches>72&&e.height_inches>70){const l=Math.min((e.reach_inches-72)*.1,2);c+=l}return Math.min(c,100)}function me(e){const t=e.Knockdowns||0,s=e.Knockdowns_Received||0,i=e.Number_of_Fights_36m||1,o=(t+s)/i;let r=(1-Math.exp(-o*1.5))*100;const c=e.win||0,a=e.win_kotko||0,d=s>0?t/s:t+1;if(t>s&&t>0){const l=Math.min(d*4,12);r+=l}const h=a;if(h>0&&i>0){const l=h/i,f=Math.min(l*15,10);r+=f}const g=i>0?e.Sig_Strikes_Thrown/i:0;if(g>100&&t>i*.3){const l=Math.min((g-100)*.03,5);r+=l}const u=i>0?e.Sig_Strikes_Absorbed/i:0,_=i>0?c/i:0;if(u>80&&_>.7&&s<i){const l=Math.min((u-80)*.02,3);r+=l}const m=i>0?(a+e.win_sub)/i:0;if(m>.4&&t>=i*.2){const l=Math.min(m*8,6);r+=l}return Math.min(Math.ceil(r*100)/100,100)}function fe(e){const s=(e.Fight_Duration_Seconds||0)/60;return Math.round(s*100)/100}function pe(e){const t=e.Control_Time_Seconds||0,s=e.Time_Controlled_Seconds||0,i=e.Number_of_Fights_36m||1,n=(t+s)/i,o=e.Fight_Duration_Seconds||300,r=n/o*100;return Math.min(Math.round(r*100)/100,100)}const $=e=>{const t=[...e].sort((i,n)=>i-n),s=Math.floor(t.length/2);return t.length%2!==0?t[s]:(t[s-1]+t[s])/2};function We(e){const{win:t,loss:s,Number_of_Fights_36m:i}=e;if(i<3)return!1;const n=i>0?t/i:0,o=U(e)/100,r=(e.Fight_Duration_Seconds||300)/60,c=(s||0)===0&&t>0,a=Me(e),d=(a.STR_DEF+a.TD_DEF)/2,h=[],g=n>=.75&&o>=.6&&r<=8;h.push(g);const u=c&&t>=5&&(o>=.4||d>=75)&&r<=10;h.push(u);const _=t>0?e.win_kotko/t:0,m=(e.Knockdowns_Received||0)>0?(e.Knockdowns||0)/(e.Knockdowns_Received||1):(e.Knockdowns||0)+1,l=n>=.7&&_>=.5&&m>=2&&a.STR_DEF>=70;h.push(l);const f=e.Sig_Strikes_Thrown>0?e.Sig_Strikes_Landed/e.Sig_Strikes_Thrown:0,p=e.Takedowns_Attempted>0?e.Takedowns_Successful/e.Takedowns_Attempted:0,S=n>=.8&&f>=.45&&(p>=.4||e.Takedowns_Attempted<3)&&d>=70&&o>=.35;h.push(S);const F=i>=6,k=e.Sig_Strikes_Absorbed/Math.max(e.Number_of_Fights_36m,1)<60,M=F&&n>=.85&&k&&(o>=.3||d>=80);return h.push(M),h.some(v=>v)}function Ge(e){return Math.round(Object.values(e).reduce((t,s)=>t+s,0)/6)}function je(e){const t=e.win||0,s=e.loss||0,i=e.Number_of_Fights_36m||0,n=(e.win_kotko||0)+(e.win_sub||0),r=(e.Career_Record||"0-0-0").split("-"),c=parseInt(r[0])||0,a=parseInt(r[1])||0,d=c+a;let h=0;return i>=4&&t>=4&&s===0&&d>=15?h=12:i>=4&&t>=3&&s<=1&&d>=12?h=10:i>=3&&t>=3&&d>=20&&c>=15?h=8:i>=3&&t>=2&&s<=1&&n>=2?h=6:i>=3&&t>=2&&d>=10&&(h=4),h}function Ue(e,t,s){const i=Object.values(e).reduce((r,c)=>r+c,0)/6,n=Object.values(t).reduce((r,c)=>r+c,0)/6;let o=Math.round(i*.6+n*.4);if(s){const r=s.win||0,c=(s.win_kotko||0)+(s.win_sub||0),d=(r>0?c/r:0)*8;o+=d;const h=je(s);if(o+=h,s.Number_of_Fights_36m<3)o=Math.min(o,65);else if(s.Number_of_Fights_36m===3){o=Math.min(o,70);const g=s.win||0,u=s.loss||0,_=s.draws||0,m=g+u+_,l=(s.Career_Record||"0-0-0").split("-").reduce((f,p)=>f+parseInt(p)||0,0);if(m>=3&&l>=8){const f=g/m;f>=.9?o+=6:f>=.8?o+=4:f>=.7&&(o+=2)}}else if(s.Number_of_Fights_36m>=4){const g=s.win||0,u=s.loss||0,_=s.draws||0,m=g+u+_;if(m>=4){const l=g/m;l>=.9?o+=12:l>=.8?o+=8:l>=.7?o+=5:l>=.6&&(o+=2)}}}return Math.max(0,Math.min(100,Math.round(o)))}function He(e){return Math.round(Object.values(e).reduce((t,s)=>t+s,0)/6)}function Qe(e,t,s){let i;t<3?i=.85+t*.06:t<5?i=1.03+(t-3)*.06:i=Math.min(1.45,1.15+(t-5)*.06);let n=1;s&&s>0&&(n=1+s/100*.15);const o=e*i*n;return o<20?1:o<35?1.5:o<45?2:o<50?2.5:o<56?3:o<61?3.5:o<80?4:o<96?4.5:5}function Ye(e){if(!e||e.trim()==="")return"";const[t,s,i]=e.split("-").map(Number);return!t||!s||!i?e:`${t.toString().padStart(2,"0")}/${s.toString().padStart(2,"0")}/${i}`}function ze(e,t){try{const s=Me(e),i=xe(e,t),n=Pe(e,i),o=Ue(s,n,e);return{id:e.id,name:e.cleanName,nameWithNickname:e.Fighter,division:e.Division,birthDate:Ye(e.Birth_Date),age:Le(e.Birth_Date),career_record:e.Career_Record||"TBD",record_36m:`${e.win}-${e.loss}-${e.draws}`,pictureUrl:e.picture_url||"",ufcstats_url:e.ufcstats_url||"",fightRadar:s,iqRadar:n,archetype:i,stars:NaN,performance:Ge(s),overall:o,fightIQ:He(n),oppTierScore:0,hasRankedOpposition:!1,streak:Ce(e.Dates_36m||""),rawData:e}}catch(s){return console.error("Error processing fighter:",e.Fighter,s),null}}function qe(e){return!e||e.length===0?0:e.filter(s=>s.opponent.divisionRanking&&s.opponent.divisionRanking!=="").length/e.length*100}function ke(e){if(!e)return[];const t=e.split(",").map(i=>i.trim()).filter(i=>i),s=new Date;return t.map(i=>{const n=i.split(":");if(n.length<3)return null;const[o,r,c]=n,[a,d,h]=o.split("-").map(Number);if(!a||!d||!h)return null;const g=new Date(h,d-1,a),u=s.getTime()-g.getTime(),_=Math.floor(u/(1e3*60*60*24*30.44));return{fighterId:r,result:c.trim(),monthsAgo:Math.max(0,_)}}).filter(i=>i!==null)}function Je(e,t){const s=t??50;if(e&&e!==""){const i=parseInt(e);if(!isNaN(i)&&i===0)return"CHAMPION"}return s>=77?"ELITE":s>=57?"CONTENDER":s>=47?"SOLID":s>=37?"DECENT":"TERRIBLE"}const Ze={CHAMPION:{W:9,L:2,D:6,NC:0},ELITE:{W:8,L:2,D:6,NC:0},CONTENDER:{W:6,L:1,D:4,NC:0},SOLID:{W:4,L:0,D:2,NC:0},DECENT:{W:1,L:0,D:0,NC:0},TERRIBLE:{W:0,L:0,D:0,NC:0}};function Xe(e){if(!e||e==="")return 1;const t=parseInt(e);return isNaN(t)?1:t===0?1.5:t>=1&&t<=3?1.25:t>=4&&t<=8?1.15:t>=9&&t<=15?1.1:1}function Ve(e,t){if(e!=="W"||!t)return 1;switch(t.toUpperCase()){case"KO":case"TKO":case"KO/TKO":return 1.3;case"SUB":case"SUBMISSION":return 1.2;case"DEC":case"DECISION":return 1;default:return 1}}function et(e,t){if(!e||e.length===0)return 0;const s=[];if(e.forEach(u=>{if(!u.opponent||typeof u.opponent.overall!="number")return;const _=Je(u.opponent.divisionRanking,u.opponent.overall),m=Ze[_]?.[u.result]??0,l=Ve(u.result,u.method),f=Xe(u.opponent.divisionRanking);let p=1;_==="CHAMPION"?p=1.6:_==="ELITE"?p=1.5:_==="CONTENDER"?p=1.3:_==="SOLID"?p=1:_==="DECENT"?p=.7:_==="TERRIBLE"&&(p=.4);const S=m*l*p*f;s.push(S)}),s.length===0)return 0;const i=Math.min(5,s.length),o=s.sort((u,_)=>_-u).slice(0,i),r=o.reduce((u,_)=>u+_,0)/o.length;let c=1;s.length===1?c=.75:s.length===2&&(c=.9);const h=r*c*1,g=Math.max(0,Math.min(10,h));return Math.round(g*100)/100}function tt(e){const t=new Map;e.forEach(n=>{t.has(n.Division)||t.set(n.Division,[]),t.get(n.Division).push(n)});const s=[],i=new Map;return t.forEach(n=>{n.forEach(o=>{const r=ze(o,n);r&&(s.push(r),i.set(r.nameWithNickname,r))})}),s.forEach(n=>{const o=ke(n.rawData.Dates_36m);if(o.length>0){const r=[];o.forEach(c=>{const a=s.find(d=>d.id===c.fighterId);a&&c.result&&r.push({opponent:{overall:a.overall,divisionRanking:a.rawData.division_ranking},result:c.result,method:void 0,monthsAgo:c.monthsAgo})}),n.hasRankedOpposition=r.some(c=>c.opponent.divisionRanking&&c.opponent.divisionRanking!==""),n.oppTierScore=et(r)}else n.hasRankedOpposition=!1,n.oppTierScore=0}),s.forEach(n=>{const o=ke(n.rawData.Dates_36m);let r=0;if(o.length>0){const c=[];o.forEach(a=>{const d=s.find(h=>h.id===a.fighterId);d&&a.result&&c.push({opponent:{overall:d.overall,divisionRanking:d.rawData.division_ranking},result:a.result,method:void 0,monthsAgo:a.monthsAgo})}),r=qe(c)}n.stars=Qe(n.overall,n.oppTierScore,r)}),s.sort((n,o)=>o.stars!==n.stars?o.stars-n.stars:o.overall+o.oppTierScore-(n.overall+n.oppTierScore)),{processedFighters:s,fightersByDivision:t,fightersMap:i}}class st{constructor(){this.allRawFightersArr=[],this.allRawFightersDataMap=new Map,this.allRawFightersByDivision=new Map,this.processedFightersMap=new Map,this.processedFighters=[],this.knownDivisions=new Set,this.cacheKey=be.FIGHTERS_CACHE,this.cacheDuration=Ee.FIGHTERS_DATA,this.buildVersion=Be,this.fightersProcessed=!1,this.isLoading=!1,this.loadingPromise=null}saveToLocalStorage(t){try{const s={...t,dataVersion:this.buildVersion};localStorage.setItem(this.cacheKey,JSON.stringify(s))}catch(s){console.warn("Failed to save data to localStorage:",s)}}loadFromLocalStorage(){try{const t=localStorage.getItem(this.cacheKey);if(!t)return null;const s=JSON.parse(t);return s.dataVersion!==this.buildVersion?(console.log("Fighters cache invalidated: version mismatch (new build deployed)",{cached:s.dataVersion,current:this.buildVersion}),localStorage.removeItem(this.cacheKey),null):Date.now()-s.timestamp>this.cacheDuration?(localStorage.removeItem(this.cacheKey),null):s}catch(t){return console.warn("Failed to load data from localStorage:",t),localStorage.removeItem(this.cacheKey),null}}populateFromCache(t){this.processedFighters=t.processedFighters||[],this.allRawFightersArr=[],this.allRawFightersDataMap.clear(),this.allRawFightersByDivision.clear(),this.processedFightersMap.clear(),this.processedFighters.forEach(s=>{this.allRawFightersArr.push(s.rawData),this.allRawFightersDataMap.set(s.rawData.Fighter,s.rawData),this.allRawFightersByDivision.has(s.rawData.Division)||this.allRawFightersByDivision.set(s.rawData.Division,[]),this.allRawFightersByDivision.get(s.rawData.Division)?.push(s.rawData),this.processedFightersMap.set(s.nameWithNickname,s)}),this.knownDivisions.clear(),t.knownDivisions.forEach(s=>{this.knownDivisions.add(s)}),this.processedFighters.sort((s,i)=>i.stars!==s.stars?i.stars-s.stars:i.overall-s.overall)}async loadFightersFromCSV(){if(this.allRawFightersDataMap.size>0&&this.fightersProcessed)return{allRawFightersArr:this.allRawFightersArr,allRawFightersDataMap:this.allRawFightersDataMap,allRawFightersByDivision:this.allRawFightersByDivision,processedFightersMap:this.processedFightersMap,processedFighters:this.processedFighters};if(this.isLoading&&this.loadingPromise)return this.loadingPromise;const t=this.loadFromLocalStorage();if(t)return this.populateFromCache(t),this.fightersProcessed=!0,{allRawFightersArr:this.allRawFightersArr,allRawFightersDataMap:this.allRawFightersDataMap,allRawFightersByDivision:this.allRawFightersByDivision,processedFightersMap:this.processedFightersMap,processedFighters:this.processedFighters};this.isLoading=!0,this.loadingPromise=this.performActualLoad();try{return await this.loadingPromise}finally{this.isLoading=!1,this.loadingPromise=null}}async performActualLoad(){try{const t=await $e(`data/ALL_DIVISIONS_DATA_WITH_URLS.csv?v=${this.buildVersion}`);this.allRawFightersArr=Oe(t),this.allRawFightersArr.forEach(r=>{this.allRawFightersDataMap.has(r.Fighter)||this.allRawFightersDataMap.set(r.Fighter,r),this.allRawFightersByDivision.has(r.Division)?this.allRawFightersByDivision.get(r?.Division)?.push(r):this.allRawFightersByDivision.set(r.Division,[r])});const s=tt(this.allRawFightersArr);this.processedFighters=s.processedFighters,this.allRawFightersByDivision=s.fightersByDivision,this.processedFightersMap=s.fightersMap;const i=new Map,n=new Map;this.processedFighters.forEach(r=>{i.set(r.nameWithNickname,r.stars),n.set(r.nameWithNickname,r.overall)}),this.allRawFightersArr.sort((r,c)=>{const a=i.get(r.Fighter)??0,d=i.get(c.Fighter)??0,h=n.get(r.Fighter)??0,g=n.get(c.Fighter)??0;return d!==a?d-a:g-h}),this.allRawFightersByDivision.forEach(r=>{r.sort((c,a)=>{const d=i.get(c.Fighter)??0,h=i.get(a.Fighter)??0,g=n.get(c.Fighter)??0,u=n.get(a.Fighter)??0;return h!==d?h-d:u-g})}),this.knownDivisions.clear(),this.allRawFightersArr.forEach(r=>{const c=r.Division.toLowerCase();this.knownDivisions.add(c),this.knownDivisions.add(c.replace(/ /g,"_")),this.knownDivisions.add(c.replace(/women's\s+/g,"w_")),this.knownDivisions.add(c.replace(/w_/g,"women's "))});const o={timestamp:Date.now(),dataVersion:this.buildVersion,processedFighters:this.processedFighters,knownDivisions:Array.from(this.knownDivisions)};return this.saveToLocalStorage(o),this.fightersProcessed=!0,{allRawFightersArr:this.allRawFightersArr,allRawFightersDataMap:this.allRawFightersDataMap,allRawFightersByDivision:this.allRawFightersByDivision,processedFightersMap:this.processedFightersMap,processedFighters:this.processedFighters}}catch(t){return console.error("Error loading fighters:",t),{allRawFightersArr:this.allRawFightersArr,allRawFightersDataMap:this.allRawFightersDataMap,allRawFightersByDivision:this.allRawFightersByDivision,processedFightersMap:this.processedFightersMap,processedFighters:this.processedFighters}}}searchFighterByNameAndNickname(t){const s=this.processedFighters,i=j(t);return s.find(n=>j(n.nameWithNickname)===i)??null}searchFightersByDivision(t){const s=this.processedFighters,i=j(t),n=j(i.replace(/womens\s+/g,"w"));return this.knownDivisions.has(i)||this.knownDivisions.has(n)?s.filter(c=>{const a=j(c.division);return a===i||a===n}):[]}getFighterById(t){return this.processedFighters.find(i=>i.id===t)||null}}const _t=new st;export{_t as a,ct as b,j as c,ut as d,gt as e,at as f,rt as g,ot as h,lt as i,dt as j,ht as k,ze as p};
